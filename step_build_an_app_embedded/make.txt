Cài ST-flash trên MSYS2 

1. Mở MSYS2 UCRT64 chạy lệnh này để cài stlink-toolset
	pacman -S mingw-w64-x86_64-stlink
2. Kiểm tra trong MSYS2 MINGW64
	Adminstrator@BUI-VAN-HAI MINGW64 ~
	$ st-flash --version
	v1.8.0

	Adminstrator@BUI-VAN-HAI MINGW64 ~
	$ which st-flash
	/mingw64/bin/st-flash
	Hiện như này là được
3. Instructions in MINGW64
	See info chip: st-info --probe
	Reset chip: st-flash reset
	Erase chip: st-flash erase
	Load chip: st-flash write file.bin 0x8000000
	Debug server GDB: st-util

4. Cách debug bằng terminal
B1: vào MINGW64 gõ st-util lúc này sẽ hiện ra "Listening at *:4242..."
B2: vào folder constant file.elf rồi chạy cmd ở đây
B3: gõ lệnh arm-none-eabi-gdb demo.elf, rồi nhập 4 lệnh tiếp theo
	target extended-remote :4242
	monitor reset halt
	load
	break main
	continue
B4: 
	run step by step: step or next
	see variables: print "variables"
	see register: info register & see stack: bt
	reset chip: monitor reset halt

Note: can add rule debug in Make program

Overview Embedded Systems Architecture

Embedded System là một hệ thống gồm phần cứng (HW) và phần mềm (SW) phối hợp với nhau 
để làm một nhiệm vụ cụ thể, ví dụ như điều khiển motor, đọc cảm biến, giao tiếp UART, kết nối internet…

1) HW: SoC, Memories, Peripherals

SoC (System on Chip)
- Đây là con chip chính, ví dụ STM32, ESP32, AVR…
- Bên trong SoC có CPU, timer, UART, SPI, I2C, ADC…
- CPU là nơi chạy chương trình, còn các ngoại vi là công cụ để CPU giao tiếp với thế giới bên ngoài

Memories 
Gồm Flash, RAM, EEPROM…
- Flash dùng để chứa chương trình (code).
- RAM dùng để chạy chương trình, lưu biến, stack, heap.
- Không có bộ nhớ thì CPU không có chỗ để chạy code.

Peripherals 
- Là các phần như GPIO, UART, SPI, I2C, ADC, PWM…
- Ngoại vi cho phép MCU nói chuyện với LED, nút nhấn, cảm biến, màn hình, motor…

2) SW: low layer, middle layer, high layer

Device Drivers: là lớp gần phần cứng nhất, code thanh ghi

Middleware: sử dụng low layer để làm các công việc phức tạp hơn

Ví dụ middleware:
	File system (FAT16, FAT32, LittleFS)
	TCP/IP stack
	USB stack
	Bluetooth stack

Middleware thường xử lý logic lớn, nhiều bước, nhiều trạng thái. Giúp người viết ứng dụng 
không phải tự làm lại những thứ phức tạp.

Operating System:
VD như FreeRTOS:
	OS quản lý task, thread, scheduling
	Quản lý thời gian, semaphore, queue

Application:
	Phần làm ra product sẽ call driver, middleware, OS API --> sẽ quyết định sản phẩm sẽ làm được gì
